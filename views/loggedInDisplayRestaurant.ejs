<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Celiac-Safe Restaurants</title>
        <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
        <!-- Google fonts-->
        <link href="https://fonts.googleapis.com/css?family=Raleway:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet" />
        <link href="https://fonts.googleapis.com/css?family=Lora:400,400i,700,700i" rel="stylesheet" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="css/styles.css" rel="stylesheet" />
        <link href="css/card.css" rel="stylesheet" />
    </head>
    <body >
        <header>
            <h1 class="site-heading text-center text-faded d-none d-lg-block">
                <span class="site-heading-upper text-primary mb-3"></span>
                <span class="site-heading-lower">Gluten-Free Gastronomy</span>
            </h1>
        </header>
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg navbar-dark py-lg-4" id="mainNav">
            <div class="container">
                <a class="navbar-brand text-uppercase fw-bold d-lg-none" href="index.html"></a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav mx-auto">
                        <li class="nav-item px-lg-4"><a class="nav-link text-uppercase" href="/">Home</a></li>
                        <li class="nav-item px-lg-4"><a class="nav-link text-uppercase" href="/login">Login</a></li>
                        <!-- <li class="nav-item px-lg-4"><a class="nav-link text-uppercase" href="products.html"></a></li>
                        <li class="nav-item px-lg-4"><a class="nav-link text-uppercase" href="store.html">Store</a></li> -->
                    </ul>
                </div>
            </div>
        </nav>
        <section class="page-section cta">
            <div class="container">
                <div class="row">
                    <div class="col-xl-9 mx-auto">
                        <div class="cta-inner bg-faded text-center rounded">
                            <h2 class="section-heading mb-5">
                                <span class="section-heading-upper">Enjoy With</span>
                                <span class="section-heading-lower">Our Selection</span>
                                <!-- This is the place where restaurants will be displayed as cards -->
                                <div id="cardList" class="card-list custom-card">
                                    <% Restaurants.forEach(function(Restaurant, index) { %>
                                        <% if (index % 2 === 0) { %>
                                            <div class="card-row">
                                        <% } %>
                                
                                        <article class="card">
                                            <figure class="card-image">
                                                <% if (Restaurant.Photo) { %>
                                                    <img src="data:image/jpeg;base64,<%= Buffer.from(Restaurant.Photo).toString('base64') %>"
                                                        alt="Restaurant Photo" style="max-width: 400px; max-height: 400px;">
                                                <% } else { %>
                                                    <p>No photo available</p>
                                                <% } %>
                                            </figure>

                                            <div class="card-header">
                                                <a href="#"><%= Restaurant.Restaurant_Name %></a>
                                                <button class="icon-button">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                                                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                                        display="block">
                                                        <path
                                                            d="M7 3C4.239 3 2 5.216 2 7.95c0 2.207.875 7.445 9.488 12.74a.985.985 0 0 0 1.024 0C21.125 15.395 22 10.157 22 7.95 22 5.216 19.761 3 17 3s-5 3-5 3-2.239-3-5-3z" />
                                                    </svg>
                                                </button>
                                            </div>
                                            
                                            <div class="card-footer">
                                                <div class="card-meta card-meta--date">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                                                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                                        display="block" id="MapMarker">
                                                        <path
                                                            d="M12 2C7.48 2 4 6.48 4 11s8 13 8 13 8-7.48 8-13-3.48-9-8-9zM12 15c-1.11 0-2-0.89-2-2s0.89-2 2-2 2 0.89 2 2-0.89 2-2 2z" />
                                                    </svg>
                                                    <span class="small-text"><%= Restaurant.Address %></span>
                                                </div>
                                            </div>
                                                <!-- Line break -->
                                                <div style="display: block; height: 10px;"></div>
                                            <div>  
                                
                                                <!-- Additional information -->
                                                <div class="card-meta card-meta--item">
                                                    
                                                    <span class="small-text">Item: <%= Restaurant.Item_Name %></span>
                                                </div>
                                            </div>

                                            <!-- Card header -->
                                            <div class="card-header">
                                                <a href="#"><%= Restaurant.Restaurant_Name %></a>
                                                <button class="icon-button" onclick="editRestaurant('<%= Restaurant.Restaurant_Id %>')">Edit</button>
                                                <button class="icon-button" onclick="deleteRestaurant('<%= Restaurant.Restaurant_Id %>')">Delete</button>
                                            </div>
                                        </article>
                                
                                        <% if (index % 2 !== 0 || index === Restaurants.length - 1) { %>
                                            </div>
                                        <% } %>
                                    <% }); %>
                                </div>

                            </h2>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        



<!--so i have database with names and for loop  will go through it and create 
    new card next to old one with information from the database-->

    <script>
        function editRestaurant(restaurantId) {
            window.location.href = `/editRestaurant/${restaurantId}`;
        }
    
        function deleteRestaurant(restaurantId) {
        const confirmed = confirm('Are you sure you want to delete this restaurant?');
        if (confirmed) {
            fetch(`/deleteRestaurant/${restaurantId}`, {
                method: 'DELETE',
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(data.message);
                    window.location.href = '/displayRestaurants'; // Redirect to displayRestaurants
                } else {
                    alert(data.message);
                }
            })
            .catch(error => console.error('Error:', error));
        }
    }
    </script>
    
       
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="js/scripts.js"></script>
    </body>
</html>
